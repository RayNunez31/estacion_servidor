<!DOCTYPE html>
<html lang="es">
<head>


    <!-- <script src="https://unpkg.com/htmx.org@1.8.5"></script>

    <script src="https://unpkg.com/htmx.org@1.9.12/dist/ext/ws.js"></script> -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estaciones</title>
    <!-- Integración de Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap">

    <style>
        /* Estilos adicionales para los frames */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #ffffff;
            margin-bottom: 30px; /* Margen general de 10 píxeles */
            padding: 50px;
        }

        .menu-divider {
            border-top: 1px solid #eee; /* Color gris claro */
            margin: 40px;
            margin-top: 20px;
            
        }

        .title-frame {
            border: 1px solid #F5F5F5;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 0px;
            background-color: #F5F5F5;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .title-frame h1 {
            background-color: #F5F5F5; /* Nuevo color de fondo del título */
            color: #1C1C1C;
            padding: 30px;
            border-radius: 20px;
            font-size: 3em; /* Tamaño de la fuente aumentado */
            margin: 10px;
        }

        .frame {
            display: flex;
            justify-content: flex-start;
            border: 1px solid #ccc;
            border-radius: 15px;
            padding: 20px;
            margin: 40px;
            margin-bottom: 60px;
            background-color: #F5F5F5;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .frame h2 {
            font-size: 1em;
            margin-bottom: 10px;
            color: #1E1E1E;
        }

        .frame p {
            margin-bottom: 20px;
            font-size: 0.9em;
            color: #757575;
        }

        .header {
            display: flex;
            justify-content: flex-end; /* Alinea los elementos al final del contenedor (derecha en este caso) */
            margin-bottom: 20px; /* Espacio inferior */
        }

        .header button {
            margin-left: 10px; /* Espacio entre botones */
            padding: 8px 16px; /* Padding para los botones */
            background-color: #2C2C2C; /* Color de fondo */
            color: #F5F5F5; /* Color de texto */
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .header button:hover {
            background-color: #1C1C1C; /* Cambio de color al pasar el ratón */
        }

        .frame-header {
            text-align: right; /* Alineación del contenido a la derecha dentro del frame */
            border: 1px solid #ffffff;
            border-radius: 0px;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(255, 255, 255, 0.1);
            margin-bottom: 10px;
        }

        .frame-header h2 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .frame-header2 .header-button-container2{
            display: flex;
            justify-content: center;
            margin: 20px;
            margin-bottom: 20px;
        }
        .frame-header2 .header-button-container2 button{
            padding: 20px;
            border-radius: 15px;
            border-color: #F5F5F5;
            margin: 15px;
            margin-bottom: 10px;
            font-size: 1.5em;
            padding-left: 80px;
            padding-right: 80px;
            background-color: #1C1C1C;
            color: #F5F5F5;
            box-shadow: none;
            transition: background-color 0.3s ease;

        }
        .frame-header2 .header-button-container2 button:hover{
            padding: 20px;
            border-radius: 15px;
            border-color: #F5F5F5;
            margin: 15px;
            margin-bottom: 10px;
            font-size: 1.5em;
            padding-left: 80px;
            padding-right: 80px;
            background-color: #757575;
            color: #F5F5F5;
            box-shadow: none;

        }

        .frame-header2 .header-button-container2 button:nth-child(1) a{
             /* Color para "Estaciones" */
             color: #F5F5F5;
            text-decoration: none;
        }
        .frame-header2 .header-button-container2 button:nth-child(2) a{
             /* Color para "Estaciones" */
             color: #F5F5F5;
            text-decoration: none;
        }


        .frame-header .header-button-container {
            display: flex;
            justify-content: right; /* Alinea los botones al centro */
            margin-bottom: 20px; /* Espacio inferior */
            
        }

        .frame-header .header-button-container button {
            margin-left: 10px;
            background-color: transparent; /* Fondo transparente */
            color: #000000; /* Color de texto */
            border: 2px solid transparent; /* Borde transparente */
            border-radius: 20px; /* Borde redondeado */
            padding: 8px 16px; /* Ajuste de padding */
            cursor: pointer;
            font-size: 1.2em;
            transition: background-color 0.3s ease;

        }

        .frame-header .header-button-container button:nth-child(1) {
            background-color: #F5F5F5; /* Color para "Estaciones" */
            text-decoration: none;
        }
        .frame-header .header-button-container button:nth-child(1) a {
            /* Color para "Estaciones" */
            text-decoration: none;
            color: #1C1C1C;
        }

        .frame-header .header-button-container button:nth-child(2) {
            background-color: #FFFFFF; /* Color para "Recursos" */
        }

        .frame-header .header-button-container button:nth-child(3) {
            background-color: #FFFFFF; /* Color para "Contacto" */
        }

        .frame-header .header-button-container button:nth-child(4) {
            background-color: #2C2C2C; /* Color para "Cerrar Sesión" */
            color: #FFFFFF; /* Cambio de color de texto para "Cerrar Sesión" */
        }

        .frame-header .header-button-container button:hover {
            background-color: #1C1C1C; /* Color de fondo al pasar el ratón */
            color: #F5F5F5;
        }

    

        .sensor-frame {
            border: 0px solid #ccc;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #F5F5F5;
            font-size: 1.5em;
        }

        .sensor-frame h2{
            margin-left: 20px;
        }

        .card {
            width:auto;
            border: 1px solid #F5F5F5;
            border-radius: 15px;
            padding: 20px;
            padding-right: 100px;
            margin: 15px;
            background-color: #FFFFFF;
            font-size: 0.8em;

        }
         .card h3{
            font-size: 1.3em;
         }


        .sensor-frame h2 {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #1E1E1E;
        }

        .sensor-frame p {
            margin-bottom: 20px;
            margin-left: 20px;
            font-size: 0.9em;
            color: #757575;
        }
        .frame :nth-child(2){
            display: flex;
        }
        .frame-img{
            display: flex;
            justify-content: flex-end;
            width:max-content;
            height: auto;
            margin-left: 1000px;
        }
        .notification-frame {
            border: 1px solid #F5F5F5;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #F5F5F5;
            font-size: 1.5em;
        }

        .notification-frame h2 {
            margin-left: 20px;
        }

        .notification-cards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px; /* Espacio entre las tarjetas */
        }

        .notification-frame .card2 {
            border: 1px solid #ccc;
            border-radius: 15px;
            padding: 20px;
            background-color: #F5F5F5;
            font-size: 0.8em;
            flex: 1 1 calc(33.333% - 20px); /* Ajuste para tres tarjetas por fila */
            box-sizing: border-box;
        }

        .notification-frame .card2 h3 {
            font-size: 1.3em;
        }

    </style>
</head>

<body>
    <div class="frame-header">
        <div class="header-button-container">
            <button  onclick="window.location.href='/'">Estaciones</a></button>
            <button>Recursos</button>
            <button>Contacto</button>
            <button onclick="window.location.href='/UserAccount/'">Mi cuenta</button>
            <form action="/logout/" method="post" id="logout-form">
                {% csrf_token %}
                <button type="submit">Cerrar Sesión</button>
            </form>
        </div>
    </div>
    <!-- Título en frame -->
    <div class="title-frame">
        <h1>Reporte del clima de la estación {{ estacion.nombre }}</h1>
        <!-- Contenedor para los datos de la última lectura -->
        <hr class="menu-divider">
        <div class="frame" id="lectura-frame">
            <div>
                {% if ultima_lectura != None %}
                    <h2>Temperatura</h2>
                    <p id="temperatura">La temperatura actual es de {{ ultima_lectura.temperatura }} °C</p>
                    <h2>Humedad</h2>
                    <p id="humedad">La humedad actual es de {{ ultima_lectura.humedad }}%</p>
                    <h2>Presión Atmosférica</h2>
                    <p id="presionatmosferica">La presión atmosférica actual es de {{ ultima_lectura.presionatmosferica }} hPa</p>
                    <h2>Velocidad del Viento</h2>
                    <p id="velocidad_del_viento">La velocidad actual del viento es de {{ ultima_lectura.velocidad_del_viento }} m/s</p>
                    <h2>Dirección del Viento</h2>
                    <p id="direccion_del_viento">La dirección actual del viento es {{ ultima_lectura.direccion_del_viento }} °</p>
                    <h2>Pluvialidad</h2>
                    <p id="pluvialidad">Pluvialidad: {{ ultima_lectura.pluvialidad }} mm</p>
                {% else %}
                    <h2>Temperatura</h2>
                    <p>-</p>
                    <h2>Humedad</h2>
                    <p>-</p>
                    <h2>Presión Atmosférica</h2>
                    <p>-</p>
                    <h2>Velocidad del Viento</h2>
                    <p>-</p>
                    <h2>Dirección del Viento</h2>
                    <p>-</p>
                    <h2>Pluvialidad</h2>
                    <p>-</p>
                {% endif %}
            </div>
        </div>
        <hr class="menu-divider">
        <!-- Segundo set de botones -->
          
        <div class="frame-header2">
            <div class="header-button-container2">
                <button onclick="window.location.href='/administrar/?estacion_id={{ estacion.id_estacion }}'">Administrar estacion</button>
                <button onclick="window.location.href='/registro_lectura/?estacion_id={{ estacion.id_estacion }}'">Ver lecturas</button>
                <button onclick="window.location.href='/alarmas/?estacion_id={{ estacion.id_estacion }}'">Administrar alarmas</button>
            </div>
        </div>
    </div>
    <br>
    <div class="notification-frame">
        <h2>Últimas Notificaciones de Alarmas</h2>
        <hr class="menu-divider">
        {% if notificaciones_estacion.all %}
            <div class="notification-cards-container">
                {% for notificacion in notificaciones_estacion.all %}
                    <div class="card2">
                        <h3>Alarma: {{ notificacion.alarma.nombre }}</h3>
                        <p>{{ notificacion.mensaje }}</p>
                        <p>Fecha y hora de activación: {{ notificacion.fecha }}</p>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No hay notificaciones asociadas a esta estación.</p>
        {% endif %}
    </div>
    <br>
    <!-- Frame para equipos conectados a la estación (sensores) -->
    <div class="sensor-frame">
        <h2>Equipos conectados a la estación</h2>
        <hr class="menu-divider">
        {% if sensores.all %}
            {% for sensor in sensores.all %}
                <div class="card">
                    <h3>ID{{ sensor.id_sensor }} - {{ sensor.nombre }}</h3>
                    <p>Modelo: {{ sensor.modelo }}</p>
                    <p>Descripción: {{ sensor.descripcion }}</p>
                </div>
            {% endfor %}
        {% else %}
            <p>No hay sensores asociados a esta estación.</p>
        {% endif %}
    </div>
    <script>
        var socket = new WebSocket('wss://' + window.location.host + '/ws/dashboard/');
        socket.onopen = function(e) {
            console.log('Websocket connected succesfully');
        };
        
        socket.onmessage = function(e) {
            console.log('Se ha recibido un mensaje');

            const data = JSON.parse(e.data);
                document.querySelector('#temperatura').innerText = `La temperatura actual es de ${data.temperatura} °C`;
                document.querySelector('#humedad').innerText = `La humedad actual es de ${data.humedad}%`;
                document.querySelector('#presionatmosferica').innerText = `La presión atmosférica actual es de ${data.presionatmosferica} hPa`;
                document.querySelector('#velocidad_del_viento').innerText = `La velocidad actual del viento es de ${data.velocidad_del_viento} m/s`;
                document.querySelector('#direccion_del_viento').innerText = `La dirección actual del viento es ${data.direccion_del_viento} °`;
                document.querySelector('#pluvialidad').innerText = `Pluvialidad: ${data.pluvialidad} mm`;
        };

        socket.onclose = function(e) {
            console.error('WebSocket closed');
        };
    </script>
</body>



</html>
